# Fingerprint model configuration for robustness testing
# This config defines the frozen model to use for all experiments

model:
  # Model type: "mert", "muq", "openl3", or path to custom model
  type: "mert"
  name: "m-a-p/MERT-v1-330M"  # HuggingFace model identifier
  path: null  # If using custom model, specify path here
  
  # Model checksum for verification (sha256)
  # Update this after freezing the model
  checksum: null
  
  # Device: "cuda", "cpu", or null for auto-detect
  # CRITICAL: Set to "cuda" if GPU available for 5-10x speedup, or "cpu" if not
  device: null  # Auto-detect (will use GPU if available)

# Audio processing parameters
audio:
  sample_rate: 44100
  segment_length: 3.0  # seconds (AGGRESSIVE: increased to 3.0s for fewer segments = faster processing)
  hop_length: null  # null = no overlap, segment_length = hop_length
  mono: true
  normalization: "peak"  # "peak", "rms", or null

# Embedding parameters
embedding:
  dimension: 512  # Expected output dimension
  normalization: "l2"  # "l2", "none"
  dtype: "float32"  # Use "float16" if GPU available for 2x speedup (requires GPU)

# Segment processing
segmentation:
  method: "fixed_length"  # CRITICAL: Changed to fixed_length (no overlap = maximum speed)
  overlap_ratio: 0.0  # CRITICAL: NO overlap for maximum speed (0.0 = no overlap)

# Aggregation parameters (for query result fusion)
# AGGRESSIVE OPTIMIZATION: Disabled expensive features for maximum speed
aggregation:
  # Similarity threshold: exclude segments with top match similarity below this
  min_similarity_threshold: 0.1  # Lowered to include more good matches
  
  # Top-K fusion: use only best-matching segments
  top_k_fusion_ratio: 0.5  # CRITICAL: Reduced from 0.75 to 0.5 (use fewer segments = faster)
  
  # Temporal consistency: weight consecutive segments matching same file
  use_temporal_consistency: false  # CRITICAL: Disabled to save computation time
  
  # Aggregation weights (must sum to ~1.0, will be normalized)
  # Optimized for speed while maintaining recall
  weights:
    similarity: 0.50      # Increased to emphasize similarity score
    rank_1: 0.35          # Increased (strongest signal for recall)
    rank_5: 0.10          # Reduced (less computation)
    match_ratio: 0.05     # Minimal
    temporal: 0.0         # Disabled (no temporal computation)
  
  # Confidence-based re-ranking
  use_confidence_rerank: false  # CRITICAL: Disabled to save computation time
  min_confidence_threshold: 0.0  # Minimum confidence to include result (0.0-1.0, 0.0 = no filtering)
  
  # Second-stage re-ranking (more thorough analysis of top candidates)
  second_stage_rerank:
    enabled: false  # Disabled to reduce latency
    top_k: 5  # Number of top candidates to re-rank (typically 3-10)
  
  # Result validation and quality checks
  validation:
    enabled: false  # CRITICAL: Disabled to save computation time
    min_quality_score: 0.0  # Minimum quality score to consider valid (0.0-1.0)
  
  # Adaptive threshold: dynamically adjust similarity threshold based on query quality
  use_adaptive_threshold: false  # CRITICAL: Disabled to save computation time
  adaptive_threshold_base: 0.1  # Base threshold (not used when disabled)
  adaptive_threshold_sensitivity: 0.1  # Sensitivity (not used when disabled)

# Multi-scale feature fusion (use multiple segment lengths for better recall)
multi_scale:
  enabled: false  # Set to true to enable multi-scale fusion (increases latency ~2-3x)
  segment_lengths:
    - 0.75  # Shorter segments for fine-grained matching
    - 1.0   # Primary segment length
    - 1.5   # Longer segments for stable matching
  weights:
    - 0.25  # Weight for shortest length
    - 0.50  # Weight for primary length
    - 0.25  # Weight for longest length

# Metadata
metadata:
  version: "v1"
  created_date: null  # Set when model is frozen
  description: "MERT-based fingerprint model for audio identification"
